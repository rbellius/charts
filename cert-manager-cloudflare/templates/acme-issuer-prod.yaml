apiVersion: cert-manager.io/v1
kind: ClusterIssuer

metadata:
  name: cloudflare-letsencrypt-prod
  annotations:
    argocd.argoproj.io/sync-wave: "5"
    argocd.argoproj.io/instance: cert-manager-cloudflare
spec:
  acme:
  
    # Email address used for ACME registration
    email: {{ .Values.email }}

    # Let's Encrypt Staging
    server: https://acme-staging-v02.api.letsencrypt.org/directory

    # Let's Encrypt Production
    # server: https://acme-v02.api.letsencrypt.org/directory


    privateKeySecretRef:
      name: issuer-account-key

    solvers:

    # DNS01 challenge
    - dns01:

        # Cloudflare DNS01 challenge provider
        cloudflare:

          # Cloudflare acccount email
          email: {{ .Values.email }}

          # Cloudflare Orgin CA API Token
          apiKeySecretRef:
            name: '{{ .Values.provider}}-api-key-secret'
            key: {{ .Values.provider }} 
      selector:
        dnsZones:
        - '{{ .Values.domain }}' 

    
# ---
# apiVersion: cert-manager.io/v1
# kind: Certificate
# metadata:
#   name: prod-cert
#   namespace: demo
# spec:
#   dnsNames:
#     - 'app.cloudbreaker.me' 
#   secretName: prod-cert
#   issuerRef:
#     name: acme-issuer
#     kind: ClusterIssuer 


      